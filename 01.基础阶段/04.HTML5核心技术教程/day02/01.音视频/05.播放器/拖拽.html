<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        * {
            margin: 0;
            padding: 0;
        }
        html, body {
            height: 100%;
            overflow: hidden;
        }
        .test {
            position: absolute;
            top: 0;
            left: 0;
            width: 200px;
            height: 200px;
            background-color: pink;
        }
        .coll {
            width: 200px;
            height: 200px;
            margin: 200px 500px;
        }
    </style>
    <script src="encapsDrag.js"></script>
    <script>
        window.onload = function() {
            // var testNode = document.querySelector(".test")
            var testNode = document.getElementsByClassName("test")[0]
            var imgNode = document.getElementsByClassName("coll")[0]

            // drag(testNode, 10, imgNode)
            $.drag(testNode, true, 10, imgNode)
            // testNode.addEventListener("mousedown", function(ev) {
            //     ev = ev || event
            //     startPoint.x = this.offsetLeft
            //     startPoint.y = this.offsetTop
            //     mouseDownPoint.x = ev.clientX
            //     mouseDownPoint.y = ev.clientY

            //     document.addEventListener("mousemove", function(ev) {
            //         ev = ev || event
            //         var mouseMovePoint = {x: 0, y: 0}
            //         mouseMovePoint.x = ev.clientX
            //         mouseMovePoint.y = ev.clientY

            //         var dis = {x: 0, y: 0}
            //         dis.x = mouseMovePoint.x - mouseDownPoint.x
            //         dis.y = mouseMovePoint.y - mouseDownPoint.y 

            //         // 移动事件绑定改为 testNode->document, 防止太快超出元素
            //         // this.style.left = startPoint.x + dis.x + "px"
            //         testNode.style.left = startPoint.x + dis.x + "px"
            //         testNode.style.top = startPoint.y + dis.y + "px"
            //     })

            //     document.addEventListener("mouseup", function() {
                    
            //     })
            // }) 
           

            /* var startPoint = {x: 0, y: 0}
            var mouseDownPoint = {x: 0, y: 0}
            
            testNode.onmousedown = function(ev) {
                ev = ev || event
                startPoint.x = this.offsetLeft
                startPoint.y = this.offsetTop
                mouseDownPoint.x = ev.clientX
                mouseDownPoint.y = ev.clientY

                // 兼容ie，ie无法阻止默认事件；将所有鼠标事件全部重新定向到testNode元素上
                if (this.setCapture) {
                    this.setCapture()
                }

                document.onmousemove = function(ev) {
                    ev = ev || event
                    var mouseMovePoint = {x: 0, y: 0}
                    mouseMovePoint.x = ev.clientX
                    mouseMovePoint.y = ev.clientY

                    var dis = {x: 0, y: 0}
                    dis.x = mouseMovePoint.x - mouseDownPoint.x
                    dis.y = mouseMovePoint.y - mouseDownPoint.y 

                    // 1.限制拖拽元素移动范围
                    var L = startPoint.x + dis.x
                    var T = startPoint.y + dis.y
                    // 2.磁性吸附 0 -> 10
                    if (L < 10) {
                        L = 0
                    } else if (L > (document.documentElement.clientWidth - testNode.offsetWidth - 10)) {
                        L = document.documentElement.clientWidth - testNode.offsetWidth
                    }
                    if (T < 10) {
                        T = 0
                    } else if (T > (document.documentElement.clientHeight - testNode.offsetHeight - 10)) {
                        T = document.documentElement.clientHeight - testNode.offsetHeight
                    }

                    testNode.style.left = L + "px"
                    testNode.style.top = T + "px"

                    // 3.碰撞检测
                    var T1 = testNode.offsetTop
                    var B1 = testNode.offsetTop + testNode.offsetHeight
                    var R1 = testNode.offsetLeft + testNode.offsetWidth
                    var L1 = testNode.offsetLeft

                    var T2 = imgNode.offsetTop
                    var B2 = imgNode.offsetTop + imgNode.offsetHeight
                    var R2 = imgNode.offsetLeft + imgNode.offsetWidth
                    var L2 = imgNode.offsetLeft

                    if (R1 < L2 || B1 < T2 || L1 > R2 || T1 > B2) {
                        // 没有撞到
                        imgNode.src = "../../../day01/08.canvas/img/g01.png"
                    } else {
                        imgNode.src = "../../../day01/08.canvas/img/g02.png"
                    }
                }

                document.onmouseup = function(ev) {
                    document.onmousemove = document.onmouseup = null

                    // 释放鼠标捕获
                    if (document.releaseCapture) {
                        document.releaseCapture()
                    }
                }
                
                // 禁止默认行为(- <=ie8)
                return false
            } */
        }
    </script>
</head>
<body>
    <p>ctal + a选中文字，浏览器默认拖拽行为</p>
    <div class="test">aaa</div>

    <img src="../../../day01/08.canvas/img/g01.png" class="coll">
</body>
</html>